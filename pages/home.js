import Head from "next/head"
import Image from "next/image"
import { useState } from "react"
import { Inter } from "next/font/google"
import styles from "@/styles/Home.module.css"
import { useEffect } from "react"
import { useRouter } from "next/router"
import { app, database } from "../firebase/config"
import { collection, addDoc, getDoc, getDocs } from "firebase/firestore"

const inter = Inter({ subsets: ["latin"] })

export default function Home() {
    const [name, setName] = useState("")
    const [age, setAge] = useState("")
    const [fireData, setFireData] = useState([])

    const databaseRef = collection(database, "CRUD Data")

    const addData = () => {
        addDoc(databaseRef, {
            name: name,
            age: Number(age),
        })
            .then(() => {
                console.log("Data saved")
                setName("")
                setAge("")
            })
            .catch((err) => {
                console.error(err)
            })
    }

    // get all data from database
    const getData = async () => {
        await getDocs(databaseRef).then((res) => {
            setFireData(
                res.docs.map((data) => {
                    return { ...data.data(), id: data.id }
                })
            )
        })
    }

    let router = useRouter()

    useEffect(() => {
        let token = sessionStorage.getItem("Token")
        if (token) {
            getData()
        }
        if (!token) {
            router.push("/register")
        }
    }, [])

    return (
        <>
            <Head>
                <title>Next Game Collector</title>
                <meta name="description" content="Generated by create next app" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            <main>
                <div className="grid place-items-center h-screen">
                    <div className=" dark:text-gray-50">
                        <p className="text-3xl font-bold text-center p-4">Home Page</p>
                        <div className="">
                            <input
                                placeholder="name"
                                className="mb-2 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                onChange={(e) => setName(e.target.value)}
                                value={name}
                                type="text"
                            />
                            <input
                                placeholder="age"
                                className="mb-2 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                onChange={(e) => setAge(e.target.value)}
                                value={age}
                                type="number"
                            />
                            <button className="focus:outline-none text-white bg-yellow-400 hover:bg-yellow-500 focus:ring-4 focus:ring-yellow-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:focus:ring-yellow-900" onClick={addData}>
                                ADD DATA
                            </button>
                        </div>
                        <div>
                            {fireData.map((data) => {
                                return (
                                    <div className="p-2 flex justify-evenly">
                                        <p className="text-xl">
                                            <span>{data.name}</span>
                                        </p>
                                        <p className="text-lg">
                                            <span>{data.age}</span>
                                        </p>
                                    </div>
                                )
                            })}
                        </div>
                    </div>
                </div>
            </main>
        </>
    )
}
